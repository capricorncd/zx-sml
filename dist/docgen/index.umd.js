/*!
 * zx-sml version 0.8.0
 * Author: Capricorncd <capricorncd@qq.com>
 * Repository: https://github.com/capricorncd/zx-sml
 * Released on: 2024-03-17 16:01:21 (GMT+0900)
 */
(function(o,E){typeof exports=="object"&&typeof module<"u"?E(exports,require("node:fs"),require("node:os"),require("node:path")):typeof define=="function"&&define.amd?define(["exports","node:fs","node:os","node:path"],E):(o=typeof globalThis<"u"?globalThis:o||self,E(o["zx-docgen"]={},o.fs,o.os,o.path))})(this,function(o,E,v,W){"use strict";const a="",y={method:"method",type:"type",document:"document",constant:"constant",property:"property"};function ee(e){return Array.isArray(e)}function R(e){return typeof e=="object"&&e!==null&&!ee(e)}function re(e){return Number.isFinite(e)}function se(e){return e.replace(/^-?[1-9]\d{0,2}(,\d{3})+/,r=>r.replace(/,/g,""))}function _(e,r=!1,s){if(typeof r=="number"&&(s=r,r=!1),typeof s!="number"&&(s=0),re(e))return e;if(typeof e=="string"){if(!r&&/^(-?\d+(?:\.\d+)?)\D*/.test(se(e)))return _(RegExp.$1,!0);const t=Number(e);return isNaN(t)?s:t}return s}const A={red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",white:"\x1B[37m"};function F(...e){console.log("ðŸ˜Ž",A.green,...e,A.white)}function x(...e){console.log("ðŸ˜•",A.yellow,...e,A.white)}function te(...e){console.log("ðŸ˜¡",A.red,...e,A.white)}const P=":--",ne={left:P,center:":--:",right:"--:"};function $(e){if(!e||E.existsSync(e)){x(`The directory already exists, or is null, ${e}`);return}const r=e.lastIndexOf("/");if(r===-1){x(`The 'dir' maybe a valid directory name, ${e}`);return}const s=e.substring(0,r);E.existsSync(s)?E.mkdirSync(e):($(s),$(e))}function N(e){return typeof e=="string"?/.+\.\w+$/.test(e):!1}function p(e){return Array.isArray(e)&&e.length>0}function V(e,r=" ",s="-"){const t=e.filter(n=>!!n);return t.length?t.join(r):s}function H(e,r,s){let t=-1;for(let n=0;n<s&&(t=e.indexOf(r,t+1),t!==-1);n++);return t}function b(e){return typeof e>"u"?[]:Array.isArray(e)?e:[e]}function w(e){return e=e.trim(),e.endsWith(";")&&(e=e.substr(0,e.length-1)),!e.includes("|")||/^(\w+<([^<]|\([^(]+\)\[\]|\w+<[^<]+>)+>|\([^(]+\)\[\])$/.test(e)?[e]:e.split(/\s*\|\s*/)}function j(e){return e.replace(/\|/g,"\\|")}function ce(e){const r=H(e,"`",2);return r===-1?"":e.substr(r+1)}function K(e){e=e.replace("@param","").trim();const r={raw:e,name:"",required:!1,types:[],desc:[]};if(/(\w+\??)\s+`([^`]+)`(.*)/.test(e)){const s=RegExp.$1;r.name=s.replace("?",""),r.required=!s.includes("?"),r.types.push(...w(RegExp.$2));const t=RegExp.$3||ce(e);r.desc.push(t.trim())}return r}function G(e){e=e.replace(/@returns?/,"").trim();const r={raw:e,types:[],desc:[]};return/`([^`]+)`\s*(.*)/.test(e)&&(r.types.push(...w(RegExp.$1)),r.desc.push(RegExp.$2)),r}function M(e){return/@sort\s*(-?\d+)/.test(e)?_(RegExp.$1):0}function q(e){return e.replace(/^([\w.]+).*/,"$1")}function k(e,r,s="Name",t={}){if(!p(e))return[];const n=t.alias||{},c=n.tableHead||{};let u={0:"no",1:"yes"};n.requiredValues&&(n.requiredValues[r]?u=n.requiredValues[r]:n.requiredValues[0]&&n.requiredValues[1]&&(u=n.requiredValues));const f=t.tableAlign||{},l={align:[f[s],f.Types,f.Required,f.Description],thead:[c[s]||s,c.Types||"Types",c.Required||"Required",c.Description||"Description"],tbody:e.map(i=>{var T;return[i.name,"`"+j((T=i.types)==null?void 0:T.join("`/`"))+"`",u[+i.required],j(V(i.desc))]})},d=U(l);return d.push(a),d}function I(e,r){const s=Object.keys(e).reduce((t,n)=>(Object.keys(e[n]).forEach(c=>{t[c]=e[n][c]}),t),{});return Y(s,r)}function Y(e,r={}){const s=[],t=Object.keys(e);return r.disableKeySorting||t.sort(),t.forEach(n=>s.push(e[n])),s.some(n=>n.sort)&&s.sort((n,c)=>n.sort-c.sort),s}function B(e,r){if(e.props)return e.props;const s=[],t=e.codes[0]||"";/\sextends\s+(.+)\s*\{/.test(t)&&RegExp.$1.split(/\s*,\s*/).map(f=>q(f.trim())).forEach(f=>{const l=r.find(d=>d.name===f);l&&(l.props||(l.props=B(l,r)),s.push(...l.props))});let n=!1,c=[];return e.codes.forEach(u=>{if(!n&&/\{\s*$/.test(u))return n=!0;if(/^\s*(?:(?:readonly|static|public)\s+)?((?:(?:\w|\[.+\])+|(?:'.+')|(?:".+"))\??)\s*:\s*([^/]*)(?:\/\/(.*))?/.test(u)){const f=RegExp.$1,l=w(RegExp.$2);c.push(RegExp.$3.trim());const d={raw:u,name:f.replace(/('|")(.+)\1/,"$2").replace(/\?/g,""),required:!f.includes("?"),desc:c.filter(Boolean),types:l},i=s.findIndex(T=>T.name===d.name);i>=0&&s.splice(i,1),s.push(d),c=[]}else/^\s*\/\/(.+)/.test(u)&&(c||(c=[]),c.push(RegExp.$1.trim()))}),s}function z(e,r=[]){return e.map((s,t)=>ne[r[t]]||P).join("|")}function U(e){if(!R(e)||!p(e.tbody))return[];const{align:r=[],thead:s,tbody:t}=e,n=[];let c=0;for(p(s)?n.push(s.join("|"),z(s,r)):(n.push(t[0].join("|"),z(t[0],r)),c=1);c<t.length;c++)n.push(t[c].join("|"));return n}function oe(e,r,s={}){const t=Object.keys(y);p(s.expendTypes)&&s.expendTypes.forEach(m=>{m&&!t.includes(m)&&t.push(m)});const n=new RegExp(`^\\*\\s*@(${t.join("|")})\\s*(.+)`),c=[y.type,y.constant];p(s.codeTypes)&&s.codeTypes.forEach(m=>{c.push(m)});let u=!1,f=!1,l="",d="",i="",T="";return E.readFileSync(e,"utf8").toString().split(new RegExp(v.EOL)).forEach(m=>{var h;const C=m;if(m=m.trim(),n.test(m)){u=!0,l=RegExp.$1;const g=RegExp.$2.trim();d=q(g),i=`${l}_${d}`,r[i]={type:l,sort:0,name:d,fullName:g,desc:[],params:[],returns:[],codes:[],private:!1,path:e};return}else if(m==="*/"&&u){u=!1;return}if(m==="/**"&&(d=""),!u||!d){d&&c.includes(l)&&m&&r[i].codes.push(C.replace(/^export(\s+default)?\s*/,""));return}if(typeof((h=s.expendTypesHandlers)==null?void 0:h[l])=="function")s.expendTypesHandlers[l](r[i],m);else{if(/^\*\s*(```\w+|@code)/.test(m)&&(f=!0),/^\*(.*)/.test(m)){T=RegExp.$1;const g=T.trim();if(g.startsWith("@param"))r[i].params.push(K(g));else if(g.startsWith("@return"))r[i].returns.push(G(g));else if(g.startsWith("@private"))r[i].private=!0;else if(g.startsWith("@sort"))r[i].sort=M(g);else if(f){g.startsWith("@code")&&(s.isExtractCodeFromComments&&r[i].codes.push(""),T=T.replace(/@code\w*/,"").trim());const S=T.replace(/^\s/,"").replace("*\\/","*/");s.isExtractCodeFromComments?r[i].codes.push(S):r[i].desc.push(S)}else r[i].desc.push(g.replace("@description","").trim())}f&&/^\*\s*```$/.test(m)&&(f=!1)}}),r}function J(e,r,s={}){const t={};return R(r)&&(s=r,r=!1),D(e,t,s),ae(t,s),r?I(t,s):t}function D(e,r,s){const{fileType:t=/\.(ts|js)$/}=s;if(Array.isArray(e))e.forEach(n=>{D(n,r,s)});else{const n=E.statSync(e);n.isDirectory()?E.readdirSync(e).forEach(c=>{D(W.join(e,c),r,s)}):n.isFile()&&t.test(e)&&(r[e]={},oe(e,r[e],s))}}function Q(e){if(Array.isArray(e))return e.filter(t=>t.type===y.type);const r=[];let s;return Object.keys(e).forEach(t=>{Object.keys(e[t]).forEach(n=>{s=e[t][n],s.type===y.type&&r.push(s)})}),r}function ae(e,r){const s=Q(e);p(r.types)&&s.push(...r.types),s.forEach(t=>{t.props=B(t,s)})}function fe(e,r,s={}){e.returns.length||e.returns.push({raw:"`void`",types:["void"],desc:[]}),r.push(`### ${e.fullName}`,a,...e.desc,a,...s.methodWithRaw?e.params.map(t=>`- @param ${t.raw}`):k(e.params,y.method,"Param",s),a,...e.returns.map(t=>`- @returns ${t.raw}`),a),O(e.codes,r)}function O(e,r){p(e)&&r.push(...e,a)}function ie(e,r,s={}){var i;r.push(`### ${e.fullName}`,a,...e.desc,a);const t=k(e.props,y.type,"Prop",s),n=["```ts",...e.codes,"```",a],u=["<details>",`<summary>${((i=s.alias)==null?void 0:i.sourceCodeSummary)||"Source Code"}</summary>`,a,...n,a,"</details>",a],{typeWithSourceCode:f,typeWithTable:l,typeWithAuto:d}=s;f&&l?r.push(...t,...n):f?r.push(...n):l?r.push(...t):t.length?r.push(...t,...u):d?r.push(...n):r.push(...u)}function ue(e){let r=0;const s=[];return e.forEach(t=>{t===a?r++:r=0,!(r>1)&&s.push(t)}),s}function le(e,r,s){var u,f,l;if(!p(e))return;const t=((u=r.alias)==null?void 0:u.types)||{},n=b((l=(f=r.lines)==null?void 0:f.afterTitle)==null?void 0:l[y.document]);let c=null;return e.forEach((d,i)=>{i===0?(c=d.name+".md",s.push(`# ${t[y.document]||d.fullName}`,a),p(n)&&s.push(...n,a)):s.push(`### ${d.fullName}`,a),s.push(...d.desc,a),O(d.codes,s)}),c}function de(e,r,s){p(e)&&(L(y.method,r,s),e.forEach(t=>{fe(t,s,r)}))}function ye(e,r,s){p(e)&&(L(y.type,r,s),e.forEach(t=>{ie(t,s,r)}))}function L(e,r,s){var u,f,l;const t=((u=r.alias)==null?void 0:u.types)||{},n={document:"Document",method:"Methods",type:"Types",constant:"Constants",property:"Property"};s.push(`## ${t[e]||n[e]||e}`,a);const c=b((l=(f=r.lines)==null?void 0:f.afterTitle)==null?void 0:l[e]);p(c)&&s.push(...c,a)}function he(e,r,s){p(e)&&(L(y.constant,r,s),e.forEach(t=>{s.push(`### ${t.fullName}`,a,...t.desc,a),p(t.codes)&&s.push("```ts",...t.codes,"```",a)}))}function pe(e,r,s){p(e)&&(L(y.property,r,s),e.forEach(t=>{s.push(`### ${t.fullName}`,a,...t.desc,a),t.returns.length&&s.push(...t.returns.map(n=>`- @returns ${n.raw}`),a),O(t.codes,s)}))}function X(e,r,s={}){var T,m,C;console.log("Output file is start ...");const t={};let n=null;e.forEach(h=>{t[h.type]||(t[h.type]=[]),t[h.type].push(h)});const c=[],u=b((T=s.lines)==null?void 0:T.start);p(u)&&c.push(...u,a);const f=((m=s.lines)==null?void 0:m.afterType)||{};(p(s.outputDocTypesAndOrder)?s.outputDocTypesAndOrder:[y.document,y.property,y.method,y.type,y.constant]).forEach(h=>{var S;const g=(S=s.handlers)==null?void 0:S[h];typeof g=="function"?g(t[h],s,c):h===y.document?n=le(t[h],s,c):h===y.property?pe(t[h],s,c):h===y.method?de(t[h],s,c):h===y.type?ye(t[h],s,c):h===y.constant&&he(t[h],s,c),f[h]&&c.push(...b(f[h]),a)});const d=b((C=s.lines)==null?void 0:C.end);p(d)&&c.push(...d,a);const i=ue(c);return r&&(N(r)?n=r:n&&(n=W.join(r,n)),n&&Z(n,i)),F(n||"no files were output!"),console.log("Output file is ended."),{outputFileName:n,lines:i,data:e}}function Z(e,r){Array.isArray(r)&&(r=r.join(v.EOL)),E.writeFileSync(e,r,"utf8")}function me(e,r,s){R(r)&&(s=r,r=void 0),s=s||{},(typeof e=="string"||p(e)&&e.every(c=>typeof c=="string"))&&(e=J(e,!0,s));const t=s.lines||{},n=s.alias||{};if(s={...s,lines:t,alias:n},r&&!E.existsSync(r))if(N(r)){const c=r.split("/");c.pop(),$(c.join("/"))}else $(r);return Array.isArray(e)?X(e,r,s):X(I(e,s),r,s)}o.BLANK_LINE=a,o.DOC_TYPES=y,o.createPropsTable=k,o.error=te,o.findCharIndex=H,o.formatAsArray=b,o.formatAsTypes=w,o.getCommentsData=J,o.getTypeName=q,o.getTypes=Q,o.handleParam=K,o.handleProps=B,o.handleReturn=G,o.handleSort=M,o.isFileLike=N,o.isValidArray=p,o.log=F,o.mergeIntoArray=I,o.mkdirSync=$,o.outputFile=me,o.replaceVerticalBarsInTables=j,o.toArray=Y,o.toStrForStrArray=V,o.toTableLines=U,o.warn=x,o.writeFileSync=Z,Object.defineProperty(o,Symbol.toStringTag,{value:"Module"})});
