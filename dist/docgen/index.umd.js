/*!
 * zx-sml version 0.7.3
 * Author: Capricorncd <capricorncd@qq.com>
 * Repository: https://github.com/capricorncd/zx-sml
 * Released on: 2023-05-15 11:56:02 (GMT+0000)
 */
(function(a,g){typeof exports=="object"&&typeof module!="undefined"?g(exports,require("node:fs"),require("node:os"),require("node:path")):typeof define=="function"&&define.amd?define(["exports","node:fs","node:os","node:path"],g):(a=typeof globalThis!="undefined"?globalThis:a||self,g(a["zx-docgen"]={},a.fs,a.os,a.path))})(this,function(a,g,A,fe){"use strict";var we=Object.defineProperty,Le=Object.defineProperties;var Ce=Object.getOwnPropertyDescriptors;var te=Object.getOwnPropertySymbols;var Re=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable;var ne=(a,g,A)=>g in a?we(a,g,{enumerable:!0,configurable:!0,writable:!0,value:A}):a[g]=A,ce=(a,g)=>{for(var A in g||(g={}))Re.call(g,A)&&ne(a,A,g[A]);if(te)for(var A of te(g))je.call(g,A)&&ne(a,A,g[A]);return a},ae=(a,g)=>Le(a,Ce(g));function x(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var $=x(g),V=x(A),W=x(fe);const f="",m={method:"method",type:"type",document:"document",constant:"constant",property:"property"};function oe(e){return Array.isArray(e)}function N(e){return typeof e=="object"&&e!==null&&!oe(e)}function ue(e){return e.replace(/^-?[1-9]\d{0,2}(,\d{3})+/,s=>s.replace(/,/g,""))}function P(e,s=!1){if(typeof e=="number")return e;if(typeof e=="string"){if(!s&&/^(-?\d+(?:\.\d+)?)\D*/.test(ue(e)))return P(RegExp.$1,!0);const r=Number(e);return isNaN(r)?0:r}return 0}const b={red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",white:"\x1B[37m"};function M(...e){console.log("\u{1F60E}",b.green,...e,b.white)}function _(...e){console.log("\u{1F615}",b.yellow,...e,b.white)}function ie(...e){console.log("\u{1F621}",b.red,...e,b.white)}const H=":--",le={left:H,center:":--:",right:"--:"};function w(e){if(!e||$.default.existsSync(e)){_(`The directory already exists, or is null, ${e}`);return}const s=e.lastIndexOf("/");if(s===-1){_(`The 'dir' maybe a valid directory name, ${e}`);return}const r=e.substring(0,s);$.default.existsSync(r)?$.default.mkdirSync(e):(w(r),w(e))}function q(e){return typeof e=="string"?/.+\.\w+$/.test(e):!1}function y(e){return Array.isArray(e)&&e.length>0}function K(e,s=" ",r="-"){const t=e.filter(n=>!!n);return t.length?t.join(s):r}function G(e,s,r){let t=-1;for(let n=0;n<r&&(t=e.indexOf(s,t+1),t!==-1);n++);return t}function S(e){return typeof e=="undefined"?[]:Array.isArray(e)?e:[e]}function C(e){return e=e.trim(),e.endsWith(";")&&(e=e.substr(0,e.length-1)),!e.includes("|")||/^(\w+<([^<]|\([^(]+\)\[\]|\w+<[^<]+>)+>|\([^(]+\)\[\])$/.test(e)?[e]:e.split(/\s*\|\s*/)}function k(e){return e.replace(/\|/g,"\\|")}function de(e){const s=G(e,"`",2);return s===-1?"":e.substr(s+1)}function Y(e){e=e.replace("@param","").trim();const s={raw:e,name:"",required:!1,types:[],desc:[]};if(/(\w+\??)\s+`([^`]+)`(.*)/.test(e)){const r=RegExp.$1;s.name=r.replace("?",""),s.required=!r.includes("?"),s.types.push(...C(RegExp.$2));const t=RegExp.$3||de(e);s.desc.push(t.trim())}return s}function z(e){e=e.replace(/@returns?/,"").trim();const s={raw:e,types:[],desc:[]};return/`([^`]+)`\s*(.*)/.test(e)&&(s.types.push(...C(RegExp.$1)),s.desc.push(RegExp.$2)),s}function U(e){return/@sort\s*(-?\d+)/.test(e)?P(RegExp.$1):0}function v(e){return e.replace(/^([\w.]+).*/,"$1")}function I(e,s,r="Name",t={}){if(!y(e))return[];const n=t.alias||{},c=n.tableHead||{};let i={0:"no",1:"yes"};n.requiredValues&&(n.requiredValues[s]?i=n.requiredValues[s]:n.requiredValues[0]&&n.requiredValues[1]&&(i=n.requiredValues));const o=t.tableAlign||{},l={align:[o[r],o.Types,o.Required,o.Description],thead:[c[r]||r,c.Types||"Types",c.Required||"Required",c.Description||"Description"],tbody:e.map(u=>{var E;return[u.name,"`"+k((E=u.types)==null?void 0:E.join("`/`"))+"`",i[+u.required],k(K(u.desc))]})},d=X(l);return d.push(f),d}function D(e,s){const r=Object.keys(e).reduce((t,n)=>(Object.keys(e[n]).forEach(c=>{t[c]=e[n][c]}),t),{});return J(r,s)}function J(e,s={}){const r=[],t=Object.keys(e);return s.disableKeySorting||t.sort(),t.forEach(n=>r.push(e[n])),r.some(n=>n.sort)&&r.sort((n,c)=>n.sort-c.sort),r}function B(e,s){if(e.props)return e.props;const r=[],t=e.codes[0]||"";/\sextends\s+(.+)\s*\{/.test(t)&&RegExp.$1.split(/\s*,\s*/).map(o=>v(o.trim())).forEach(o=>{const l=s.find(d=>d.name===o);l&&(l.props||(l.props=B(l,s)),r.push(...l.props))});let n=!1,c=[];return e.codes.forEach(i=>{if(!n&&/\{\s*$/.test(i))return n=!0;if(/^\s*(?:(?:readonly|static|public)\s+)?((?:(?:\w|\[.+\])+|(?:'.+')|(?:".+"))\??)\s*:\s*([^/]*)(?:\/\/(.*))?/.test(i)){const o=RegExp.$1,l=C(RegExp.$2);c.push(RegExp.$3.trim());const d={raw:i,name:o.replace(/('|")(.+)\1/,"$2").replace(/\?/g,""),required:!o.includes("?"),desc:c.filter(Boolean),types:l},u=r.findIndex(E=>E.name===d.name);u>=0&&r.splice(u,1),r.push(d),c=[]}else/^\s*\/\/(.+)/.test(i)&&(c||(c=[]),c.push(RegExp.$1.trim()))}),r}function Q(e,s=[]){return e.map((r,t)=>le[s[t]]||H).join("|")}function X(e){if(!N(e)||!y(e.tbody))return[];const{align:s=[],thead:r,tbody:t}=e,n=[];let c=0;for(y(r)?n.push(r.join("|"),Q(r,s)):(n.push(t[0].join("|"),Q(t[0],s)),c=1);c<t.length;c++)n.push(t[c].join("|"));return n}function he(e,s,r={}){const t=Object.keys(m);y(r.expendTypes)&&r.expendTypes.forEach(p=>{p&&!t.includes(p)&&t.push(p)});const n=new RegExp(`^\\*\\s*@(${t.join("|")})\\s*(.+)`),c=[m.type,m.constant];y(r.codeTypes)&&r.codeTypes.forEach(p=>{c.push(p)});let i=!1,o=!1,l="",d="",u="",E="";return $.default.readFileSync(e,"utf8").toString().split(new RegExp(V.default.EOL)).forEach(p=>{var h;const j=p;if(p=p.trim(),n.test(p)){i=!0,l=RegExp.$1;const T=RegExp.$2.trim();d=v(T),u=`${l}_${d}`,s[u]={type:l,sort:0,name:d,fullName:T,desc:[],params:[],returns:[],codes:[],private:!1,path:e};return}else if(p==="*/"&&i){i=!1;return}if(p==="/**"&&(d=""),!i||!d){d&&c.includes(l)&&p&&s[u].codes.push(j.replace(/^export(\s+default)?\s*/,""));return}if(typeof((h=r.expendTypesHandlers)==null?void 0:h[l])=="function")r.expendTypesHandlers[l](s[u],p);else{if(/^\*\s*(```\w+|@code)/.test(p)&&(o=!0),/^\*(.*)/.test(p)){E=RegExp.$1;const T=E.trim();if(T.startsWith("@param"))s[u].params.push(Y(T));else if(T.startsWith("@return"))s[u].returns.push(z(T));else if(T.startsWith("@private"))s[u].private=!0;else if(T.startsWith("@sort"))s[u].sort=U(T);else if(o){T.startsWith("@code")&&(r.isExtractCodeFromComments&&s[u].codes.push(""),E=E.replace(/@code\w*/,"").trim());const L=E.replace(/^\s/,"").replace("*\\/","*/");r.isExtractCodeFromComments?s[u].codes.push(L):s[u].desc.push(L)}else s[u].desc.push(T.replace("@description","").trim())}o&&/^\*\s*```$/.test(p)&&(o=!1)}}),s}function Z(e,s,r={}){const t={};return N(s)&&(r=s,s=!1),O(e,t,r),ye(t,r),s?D(t,r):t}function O(e,s,r){const{fileType:t=/\.(ts|js)$/}=r;if(Array.isArray(e))e.forEach(n=>{O(n,s,r)});else{const n=$.default.statSync(e);n.isDirectory()?$.default.readdirSync(e).forEach(c=>{O(W.default.join(e,c),s,r)}):n.isFile()&&t.test(e)&&(s[e]={},he(e,s[e],r))}}function ee(e){if(Array.isArray(e))return e.filter(t=>t.type===m.type);const s=[];let r;return Object.keys(e).forEach(t=>{Object.keys(e[t]).forEach(n=>{r=e[t][n],r.type===m.type&&s.push(r)})}),s}function ye(e,s){const r=ee(e);y(s.types)&&r.push(...s.types),r.forEach(t=>{t.props=B(t,r)})}function pe(e,s,r={}){e.returns.length||e.returns.push({raw:"`void`",types:["void"],desc:[]}),s.push(`### ${e.fullName}`,f,...e.desc,f,...r.methodWithRaw?e.params.map(t=>`- @param ${t.raw}`):I(e.params,m.method,"Param",r),f,...e.returns.map(t=>`- @returns ${t.raw}`),f),F(e.codes,s)}function F(e,s){y(e)&&s.push(...e,f)}function me(e,s,r={}){var u;s.push(`### ${e.fullName}`,f,...e.desc,f);const t=I(e.props,m.type,"Prop",r),n=["```ts",...e.codes,"```",f],c=(u=r.alias)==null?void 0:u.sourceCodeSummary,i=["<details>",`<summary>${c||"Source Code"}</summary>`,f,...n,f,"</details>",f],{typeWithSourceCode:o,typeWithTable:l,typeWithAuto:d}=r;o&&l?s.push(...t,...n):o?s.push(...n):l?s.push(...t):t.length?s.push(...t,...i):d?s.push(...n):s.push(...i)}function ge(e){let s=0;const r=[];return e.forEach(t=>{t===f?s++:s=0,!(s>1)&&r.push(t)}),r}function Te(e,s,r){var i,o,l;if(!y(e))return;const t=((i=s.alias)==null?void 0:i.types)||{},n=S((l=(o=s.lines)==null?void 0:o.afterTitle)==null?void 0:l[m.document]);let c=null;return e.forEach((d,u)=>{u===0?(c=d.name+".md",r.push(`# ${t[m.document]||d.fullName}`,f),y(n)&&r.push(...n,f)):r.push(`### ${d.fullName}`,f),r.push(...d.desc,f),F(d.codes,r)}),c}function Ee(e,s,r){!y(e)||(R(m.method,s,r),e.forEach(t=>{pe(t,r,s)}))}function Ae(e,s,r){!y(e)||(R(m.type,s,r),e.forEach(t=>{me(t,r,s)}))}function R(e,s,r){var i,o,l;const t=((i=s.alias)==null?void 0:i.types)||{},n={document:"Document",method:"Methods",type:"Types",constant:"Constants",property:"Property"};r.push(`## ${t[e]||n[e]||e}`,f);const c=S((l=(o=s.lines)==null?void 0:o.afterTitle)==null?void 0:l[e]);y(c)&&r.push(...c,f)}function $e(e,s,r){!y(e)||(R(m.constant,s,r),e.forEach(t=>{r.push(`### ${t.fullName}`,f,...t.desc,f),y(t.codes)&&r.push("```ts",...t.codes,"```",f)}))}function be(e,s,r){!y(e)||(R(m.property,s,r),e.forEach(t=>{r.push(`### ${t.fullName}`,f,...t.desc,f),F(t.codes,r)}))}function se(e,s,r={}){var E,p,j;console.log("Output file is start ...");const t={};let n=null;e.forEach(h=>{t[h.type]||(t[h.type]=[]),t[h.type].push(h)});const c=[],i=S((E=r.lines)==null?void 0:E.start);y(i)&&c.push(...i,f);const o=((p=r.lines)==null?void 0:p.afterType)||{};(y(r.outputDocTypesAndOrder)?r.outputDocTypesAndOrder:["document","method","type","constant"]).forEach(h=>{var L;const T=(L=r.handlers)==null?void 0:L[h];typeof T=="function"?T(t[h],r,c):h===m.document?n=Te(t[h],r,c):h===m.property?be(t[h],r,c):h===m.method?Ee(t[h],r,c):h===m.type?Ae(t[h],r,c):h===m.constant&&$e(t[h],r,c),o[h]&&c.push(...S(o[h]),f)});const d=S((j=r.lines)==null?void 0:j.end);y(d)&&c.push(...d,f);const u=ge(c);return s&&(q(s)?n=s:n&&(n=W.default.join(s,n)),n&&re(n,u)),M(n||"no files were output!"),console.log("Output file is ended."),{outputFileName:n,lines:u,data:e}}function re(e,s){Array.isArray(s)&&(s=s.join(V.default.EOL)),$.default.writeFileSync(e,s,"utf8")}function Se(e,s,r){N(s)&&(r=s,s=void 0),r=r||{},(typeof e=="string"||y(e)&&e.every(c=>typeof c=="string"))&&(e=Z(e,!0,r));const t=r.lines||{},n=r.alias||{};if(r=ae(ce({},r),{lines:t,alias:n}),s&&!$.default.existsSync(s))if(q(s)){const c=s.split("/");c.pop(),w(c.join("/"))}else w(s);return Array.isArray(e)?se(e,s,r):se(D(e,r),s,r)}a.BLANK_LINE=f,a.DOC_TYPES=m,a.createPropsTable=I,a.error=ie,a.findCharIndex=G,a.formatAsArray=S,a.formatAsTypes=C,a.getCommentsData=Z,a.getTypeName=v,a.getTypes=ee,a.handleParam=Y,a.handleProps=B,a.handleReturn=z,a.handleSort=U,a.isFileLike=q,a.isValidArray=y,a.log=M,a.mergeIntoArray=D,a.mkdirSync=w,a.outputFile=Se,a.replaceVerticalBarsInTables=k,a.toArray=J,a.toStrForStrArray=K,a.toTableLines=X,a.warn=_,a.writeFileSync=re,Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
