/*!
 * zx-sml version 0.7.5
 * Author: Capricorncd <capricorncd@qq.com>
 * Repository: https://github.com/capricorncd/zx-sml
 * Released on: 2023-05-17 20:41:58 (GMT+0900)
 */
(function(a,g){typeof exports=="object"&&typeof module!="undefined"?g(exports,require("node:fs"),require("node:os"),require("node:path")):typeof define=="function"&&define.amd?define(["exports","node:fs","node:os","node:path"],g):(a=typeof globalThis!="undefined"?globalThis:a||self,g(a["zx-docgen"]={},a.fs,a.os,a.path))})(this,function(a,g,A,fe){"use strict";var we=Object.defineProperty,Le=Object.defineProperties;var Ce=Object.getOwnPropertyDescriptors;var te=Object.getOwnPropertySymbols;var Re=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable;var ne=(a,g,A)=>g in a?we(a,g,{enumerable:!0,configurable:!0,writable:!0,value:A}):a[g]=A,ce=(a,g)=>{for(var A in g||(g={}))Re.call(g,A)&&ne(a,A,g[A]);if(te)for(var A of te(g))je.call(g,A)&&ne(a,A,g[A]);return a},ae=(a,g)=>Le(a,Ce(g));function x(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var $=x(g),V=x(A),W=x(fe);const f="",h={method:"method",type:"type",document:"document",constant:"constant",property:"property"};function oe(e){return Array.isArray(e)}function N(e){return typeof e=="object"&&e!==null&&!oe(e)}function ue(e){return e.replace(/^-?[1-9]\d{0,2}(,\d{3})+/,r=>r.replace(/,/g,""))}function P(e,r=!1){if(typeof e=="number")return e;if(typeof e=="string"){if(!r&&/^(-?\d+(?:\.\d+)?)\D*/.test(ue(e)))return P(RegExp.$1,!0);const s=Number(e);return isNaN(s)?0:s}return 0}const b={red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",white:"\x1B[37m"};function M(...e){console.log("\u{1F60E}",b.green,...e,b.white)}function _(...e){console.log("\u{1F615}",b.yellow,...e,b.white)}function le(...e){console.log("\u{1F621}",b.red,...e,b.white)}const H=":--",ie={left:H,center:":--:",right:"--:"};function w(e){if(!e||$.default.existsSync(e)){_(`The directory already exists, or is null, ${e}`);return}const r=e.lastIndexOf("/");if(r===-1){_(`The 'dir' maybe a valid directory name, ${e}`);return}const s=e.substring(0,r);$.default.existsSync(s)?$.default.mkdirSync(e):(w(s),w(e))}function q(e){return typeof e=="string"?/.+\.\w+$/.test(e):!1}function p(e){return Array.isArray(e)&&e.length>0}function K(e,r=" ",s="-"){const t=e.filter(n=>!!n);return t.length?t.join(r):s}function G(e,r,s){let t=-1;for(let n=0;n<s&&(t=e.indexOf(r,t+1),t!==-1);n++);return t}function S(e){return typeof e=="undefined"?[]:Array.isArray(e)?e:[e]}function C(e){return e=e.trim(),e.endsWith(";")&&(e=e.substr(0,e.length-1)),!e.includes("|")||/^(\w+<([^<]|\([^(]+\)\[\]|\w+<[^<]+>)+>|\([^(]+\)\[\])$/.test(e)?[e]:e.split(/\s*\|\s*/)}function k(e){return e.replace(/\|/g,"\\|")}function de(e){const r=G(e,"`",2);return r===-1?"":e.substr(r+1)}function Y(e){e=e.replace("@param","").trim();const r={raw:e,name:"",required:!1,types:[],desc:[]};if(/(\w+\??)\s+`([^`]+)`(.*)/.test(e)){const s=RegExp.$1;r.name=s.replace("?",""),r.required=!s.includes("?"),r.types.push(...C(RegExp.$2));const t=RegExp.$3||de(e);r.desc.push(t.trim())}return r}function z(e){e=e.replace(/@returns?/,"").trim();const r={raw:e,types:[],desc:[]};return/`([^`]+)`\s*(.*)/.test(e)&&(r.types.push(...C(RegExp.$1)),r.desc.push(RegExp.$2)),r}function U(e){return/@sort\s*(-?\d+)/.test(e)?P(RegExp.$1):0}function v(e){return e.replace(/^([\w.]+).*/,"$1")}function I(e,r,s="Name",t={}){if(!p(e))return[];const n=t.alias||{},c=n.tableHead||{};let l={0:"no",1:"yes"};n.requiredValues&&(n.requiredValues[r]?l=n.requiredValues[r]:n.requiredValues[0]&&n.requiredValues[1]&&(l=n.requiredValues));const o=t.tableAlign||{},i={align:[o[s],o.Types,o.Required,o.Description],thead:[c[s]||s,c.Types||"Types",c.Required||"Required",c.Description||"Description"],tbody:e.map(u=>{var E;return[u.name,"`"+k((E=u.types)==null?void 0:E.join("`/`"))+"`",l[+u.required],k(K(u.desc))]})},d=X(i);return d.push(f),d}function D(e,r){const s=Object.keys(e).reduce((t,n)=>(Object.keys(e[n]).forEach(c=>{t[c]=e[n][c]}),t),{});return J(s,r)}function J(e,r={}){const s=[],t=Object.keys(e);return r.disableKeySorting||t.sort(),t.forEach(n=>s.push(e[n])),s.some(n=>n.sort)&&s.sort((n,c)=>n.sort-c.sort),s}function B(e,r){if(e.props)return e.props;const s=[],t=e.codes[0]||"";/\sextends\s+(.+)\s*\{/.test(t)&&RegExp.$1.split(/\s*,\s*/).map(o=>v(o.trim())).forEach(o=>{const i=r.find(d=>d.name===o);i&&(i.props||(i.props=B(i,r)),s.push(...i.props))});let n=!1,c=[];return e.codes.forEach(l=>{if(!n&&/\{\s*$/.test(l))return n=!0;if(/^\s*(?:(?:readonly|static|public)\s+)?((?:(?:\w|\[.+\])+|(?:'.+')|(?:".+"))\??)\s*:\s*([^/]*)(?:\/\/(.*))?/.test(l)){const o=RegExp.$1,i=C(RegExp.$2);c.push(RegExp.$3.trim());const d={raw:l,name:o.replace(/('|")(.+)\1/,"$2").replace(/\?/g,""),required:!o.includes("?"),desc:c.filter(Boolean),types:i},u=s.findIndex(E=>E.name===d.name);u>=0&&s.splice(u,1),s.push(d),c=[]}else/^\s*\/\/(.+)/.test(l)&&(c||(c=[]),c.push(RegExp.$1.trim()))}),s}function Q(e,r=[]){return e.map((s,t)=>ie[r[t]]||H).join("|")}function X(e){if(!N(e)||!p(e.tbody))return[];const{align:r=[],thead:s,tbody:t}=e,n=[];let c=0;for(p(s)?n.push(s.join("|"),Q(s,r)):(n.push(t[0].join("|"),Q(t[0],r)),c=1);c<t.length;c++)n.push(t[c].join("|"));return n}function he(e,r,s={}){const t=Object.keys(h);p(s.expendTypes)&&s.expendTypes.forEach(m=>{m&&!t.includes(m)&&t.push(m)});const n=new RegExp(`^\\*\\s*@(${t.join("|")})\\s*(.+)`),c=[h.type,h.constant];p(s.codeTypes)&&s.codeTypes.forEach(m=>{c.push(m)});let l=!1,o=!1,i="",d="",u="",E="";return $.default.readFileSync(e,"utf8").toString().split(new RegExp(V.default.EOL)).forEach(m=>{var y;const j=m;if(m=m.trim(),n.test(m)){l=!0,i=RegExp.$1;const T=RegExp.$2.trim();d=v(T),u=`${i}_${d}`,r[u]={type:i,sort:0,name:d,fullName:T,desc:[],params:[],returns:[],codes:[],private:!1,path:e};return}else if(m==="*/"&&l){l=!1;return}if(m==="/**"&&(d=""),!l||!d){d&&c.includes(i)&&m&&r[u].codes.push(j.replace(/^export(\s+default)?\s*/,""));return}if(typeof((y=s.expendTypesHandlers)==null?void 0:y[i])=="function")s.expendTypesHandlers[i](r[u],m);else{if(/^\*\s*(```\w+|@code)/.test(m)&&(o=!0),/^\*(.*)/.test(m)){E=RegExp.$1;const T=E.trim();if(T.startsWith("@param"))r[u].params.push(Y(T));else if(T.startsWith("@return"))r[u].returns.push(z(T));else if(T.startsWith("@private"))r[u].private=!0;else if(T.startsWith("@sort"))r[u].sort=U(T);else if(o){T.startsWith("@code")&&(s.isExtractCodeFromComments&&r[u].codes.push(""),E=E.replace(/@code\w*/,"").trim());const L=E.replace(/^\s/,"").replace("*\\/","*/");s.isExtractCodeFromComments?r[u].codes.push(L):r[u].desc.push(L)}else r[u].desc.push(T.replace("@description","").trim())}o&&/^\*\s*```$/.test(m)&&(o=!1)}}),r}function Z(e,r,s={}){const t={};return N(r)&&(s=r,r=!1),O(e,t,s),ye(t,s),r?D(t,s):t}function O(e,r,s){const{fileType:t=/\.(ts|js)$/}=s;if(Array.isArray(e))e.forEach(n=>{O(n,r,s)});else{const n=$.default.statSync(e);n.isDirectory()?$.default.readdirSync(e).forEach(c=>{O(W.default.join(e,c),r,s)}):n.isFile()&&t.test(e)&&(r[e]={},he(e,r[e],s))}}function ee(e){if(Array.isArray(e))return e.filter(t=>t.type===h.type);const r=[];let s;return Object.keys(e).forEach(t=>{Object.keys(e[t]).forEach(n=>{s=e[t][n],s.type===h.type&&r.push(s)})}),r}function ye(e,r){const s=ee(e);p(r.types)&&s.push(...r.types),s.forEach(t=>{t.props=B(t,s)})}function pe(e,r,s={}){e.returns.length||e.returns.push({raw:"`void`",types:["void"],desc:[]}),r.push(`### ${e.fullName}`,f,...e.desc,f,...s.methodWithRaw?e.params.map(t=>`- @param ${t.raw}`):I(e.params,h.method,"Param",s),f,...e.returns.map(t=>`- @returns ${t.raw}`),f),F(e.codes,r)}function F(e,r){p(e)&&r.push(...e,f)}function me(e,r,s={}){var u;r.push(`### ${e.fullName}`,f,...e.desc,f);const t=I(e.props,h.type,"Prop",s),n=["```ts",...e.codes,"```",f],c=(u=s.alias)==null?void 0:u.sourceCodeSummary,l=["<details>",`<summary>${c||"Source Code"}</summary>`,f,...n,f,"</details>",f],{typeWithSourceCode:o,typeWithTable:i,typeWithAuto:d}=s;o&&i?r.push(...t,...n):o?r.push(...n):i?r.push(...t):t.length?r.push(...t,...l):d?r.push(...n):r.push(...l)}function ge(e){let r=0;const s=[];return e.forEach(t=>{t===f?r++:r=0,!(r>1)&&s.push(t)}),s}function Te(e,r,s){var l,o,i;if(!p(e))return;const t=((l=r.alias)==null?void 0:l.types)||{},n=S((i=(o=r.lines)==null?void 0:o.afterTitle)==null?void 0:i[h.document]);let c=null;return e.forEach((d,u)=>{u===0?(c=d.name+".md",s.push(`# ${t[h.document]||d.fullName}`,f),p(n)&&s.push(...n,f)):s.push(`### ${d.fullName}`,f),s.push(...d.desc,f),F(d.codes,s)}),c}function Ee(e,r,s){!p(e)||(R(h.method,r,s),e.forEach(t=>{pe(t,s,r)}))}function Ae(e,r,s){!p(e)||(R(h.type,r,s),e.forEach(t=>{me(t,s,r)}))}function R(e,r,s){var l,o,i;const t=((l=r.alias)==null?void 0:l.types)||{},n={document:"Document",method:"Methods",type:"Types",constant:"Constants",property:"Property"};s.push(`## ${t[e]||n[e]||e}`,f);const c=S((i=(o=r.lines)==null?void 0:o.afterTitle)==null?void 0:i[e]);p(c)&&s.push(...c,f)}function $e(e,r,s){!p(e)||(R(h.constant,r,s),e.forEach(t=>{s.push(`### ${t.fullName}`,f,...t.desc,f),p(t.codes)&&s.push("```ts",...t.codes,"```",f)}))}function be(e,r,s){!p(e)||(R(h.property,r,s),e.forEach(t=>{s.push(`### ${t.fullName}`,f,...t.desc,f),t.returns.length&&s.push(...t.returns.map(n=>`- @returns ${n.raw}`),f),F(t.codes,s)}))}function re(e,r,s={}){var E,m,j;console.log("Output file is start ...");const t={};let n=null;e.forEach(y=>{t[y.type]||(t[y.type]=[]),t[y.type].push(y)});const c=[],l=S((E=s.lines)==null?void 0:E.start);p(l)&&c.push(...l,f);const o=((m=s.lines)==null?void 0:m.afterType)||{};(p(s.outputDocTypesAndOrder)?s.outputDocTypesAndOrder:[h.document,h.property,h.method,h.type,h.constant]).forEach(y=>{var L;const T=(L=s.handlers)==null?void 0:L[y];typeof T=="function"?T(t[y],s,c):y===h.document?n=Te(t[y],s,c):y===h.property?be(t[y],s,c):y===h.method?Ee(t[y],s,c):y===h.type?Ae(t[y],s,c):y===h.constant&&$e(t[y],s,c),o[y]&&c.push(...S(o[y]),f)});const d=S((j=s.lines)==null?void 0:j.end);p(d)&&c.push(...d,f);const u=ge(c);return r&&(q(r)?n=r:n&&(n=W.default.join(r,n)),n&&se(n,u)),M(n||"no files were output!"),console.log("Output file is ended."),{outputFileName:n,lines:u,data:e}}function se(e,r){Array.isArray(r)&&(r=r.join(V.default.EOL)),$.default.writeFileSync(e,r,"utf8")}function Se(e,r,s){N(r)&&(s=r,r=void 0),s=s||{},(typeof e=="string"||p(e)&&e.every(c=>typeof c=="string"))&&(e=Z(e,!0,s));const t=s.lines||{},n=s.alias||{};if(s=ae(ce({},s),{lines:t,alias:n}),r&&!$.default.existsSync(r))if(q(r)){const c=r.split("/");c.pop(),w(c.join("/"))}else w(r);return Array.isArray(e)?re(e,r,s):re(D(e,s),r,s)}a.BLANK_LINE=f,a.DOC_TYPES=h,a.createPropsTable=I,a.error=le,a.findCharIndex=G,a.formatAsArray=S,a.formatAsTypes=C,a.getCommentsData=Z,a.getTypeName=v,a.getTypes=ee,a.handleParam=Y,a.handleProps=B,a.handleReturn=z,a.handleSort=U,a.isFileLike=q,a.isValidArray=p,a.log=M,a.mergeIntoArray=D,a.mkdirSync=w,a.outputFile=Se,a.replaceVerticalBarsInTables=k,a.toArray=J,a.toStrForStrArray=K,a.toTableLines=X,a.warn=_,a.writeFileSync=se,Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
