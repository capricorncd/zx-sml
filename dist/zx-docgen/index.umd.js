/*!
 * zx-sml version 0.7.0
 * Author: Xing Zhong<zx198401@gmail.com>
 * Repository: https://github.com/capricorncd/zx-sml
 * Released on: 2023-05-12 21:09:17 (GMT+0900)
 */
(function(a,p){typeof exports=="object"&&typeof module!="undefined"?p(exports,require("node:fs"),require("node:os"),require("node:path")):typeof define=="function"&&define.amd?define(["exports","node:fs","node:os","node:path"],p):(a=typeof globalThis!="undefined"?globalThis:a||self,p(a.zxDocgen={},a.fs,a.os,a.path))})(this,function(a,p,E,ae){"use strict";var $e=Object.defineProperty,Se=Object.defineProperties;var we=Object.getOwnPropertyDescriptors;var te=Object.getOwnPropertySymbols;var Le=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable;var re=(a,p,E)=>p in a?$e(a,p,{enumerable:!0,configurable:!0,writable:!0,value:E}):a[p]=E,ne=(a,p)=>{for(var E in p||(p={}))Le.call(p,E)&&re(a,E,p[E]);if(te)for(var E of te(p))Ce.call(p,E)&&re(a,E,p[E]);return a},ce=(a,p)=>Se(a,we(p));function R(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var b=R(p),V=R(E),W=R(ae);const i="",g={method:"method",type:"type",document:"document",constant:"constant"};function fe(e){return Array.isArray(e)}function N(e){return typeof e=="object"&&e!==null&&!fe(e)}function oe(e){return e.replace(/^-?[1-9]\d{0,2}(,\d{3})+/,s=>s.replace(/,/g,""))}function P(e,s=!1){if(typeof e=="number")return e;if(typeof e=="string"){if(!s&&/^(-?\d+(?:\.\d+)?)\D*/.test(oe(e)))return P(RegExp.$1,!0);const t=Number(e);return isNaN(t)?0:t}return 0}const $={red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",white:"\x1B[37m"};function H(...e){console.log("\u{1F60E}",$.green,...e,$.white)}function _(...e){console.log("\u{1F615}",$.yellow,...e,$.white)}function ue(...e){console.log("\u{1F621}",$.red,...e,$.white)}function w(e){if(!e||b.default.existsSync(e)){_(`The directory already exists, or is null, ${e}`);return}const s=e.lastIndexOf("/");if(s===-1){_(`The 'dir' maybe a valid directory name, ${e}`);return}const t=e.substring(0,s);b.default.existsSync(t)?b.default.mkdirSync(e):(w(t),w(e))}function k(e){return typeof e=="string"?/.+\.\w+$/.test(e):!1}function m(e){return Array.isArray(e)&&e.length>0}function M(e,s=" ",t="-"){const r=e.filter(n=>!!n);return r.length?r.join(s):t}function K(e,s,t){let r=-1;for(let n=0;n<t&&(r=e.indexOf(s,r+1),r!==-1);n++);return r}function S(e){return typeof e=="undefined"?[]:Array.isArray(e)?e:[e]}function C(e){return e=e.trim(),e.endsWith(";")&&(e=e.substr(0,e.length-1)),!e.includes("|")||/^(\w+<([^<]|\([^(]+\)\[\]|\w+<[^<]+>)+>|\([^(]+\)\[\])$/.test(e)?[e]:e.split(/\s*\|\s*/)}function q(e){return e.replace(/\|/g,"\\|")}function le(e){const s=K(e,"`",2);return s===-1?"":e.substr(s+1)}function G(e){e=e.replace("@param","").trim();const s={raw:e};if(/(\w+\??)\s+`([^`]+)`(.*)/.test(e)){const t=RegExp.$1;s.name=t.replace("?",""),s.required=!t.includes("?"),s.types=C(RegExp.$2);const r=RegExp.$3||le(e);s.desc=[r.trim()]}return s}function Y(e){e=e.replace(/@returns?/,"").trim();const s={raw:e};return/`([^`]+)`\s*(.*)/.test(e)&&(s.types=C(RegExp.$1),s.desc=[RegExp.$2]),s}function z(e){return/@sort\s*(-?\d+)/.test(e)?P(RegExp.$1):0}function I(e){return e.replace(/^([\w.]+).*/,"$1")}function v(e,s,t="Name",r={}){if(!m(e))return[];const n=r.alias||{},c=n.tableHead||{};let f={0:"no",1:"yes"};n.requiredValues&&(n.requiredValues[s]?f=n.requiredValues[s]:n.requiredValues[0]&&n.requiredValues[1]&&(f=n.requiredValues));const o={thead:[c[t]||t,c.Types||"Types",c.Required||"Required",c.Description||"Description"],tbody:e.map(l=>{var d;return[l.name,"`"+q((d=l.types)==null?void 0:d.join("`/`"))+"`",f[+l.required],q(M(l.desc))]})},u=J(o);return u.push(i),u}function D(e,s){const t=Object.keys(e).reduce((r,n)=>(Object.keys(e[n]).forEach(c=>{r[c]=e[n][c]}),r),{});return U(t,s)}function U(e,s={}){const t=[],r=Object.keys(e);return s.disableKeySorting||r.sort(),r.forEach(n=>t.push(e[n])),t.some(n=>n.sort)&&t.sort((n,c)=>n.sort-c.sort),t}function B(e,s){if(e.props)return e.props;const t=[],r=e.codes[0]||"";/\sextends\s+(.+)\s*\{/.test(r)&&RegExp.$1.split(/\s*,\s*/).map(o=>I(o.trim())).forEach(o=>{const u=s.find(l=>l.name===o);u&&(u.props||(u.props=B(u,s)),t.push(...u.props))});let n=!1,c=[];return e.codes.forEach(f=>{if(!n&&/\{\s*$/.test(f))return n=!0;if(/^\s*(?:(?:readonly|static|public)\s+)?((?:(?:\w|\[.+\])+|(?:'.+')|(?:".+"))\??)\s*:\s*([^/]*)(?:\/\/(.*))?/.test(f)){const o=RegExp.$1,u=C(RegExp.$2);c.push(RegExp.$3.trim());const l={name:o.replace(/('|")(.+)\1/,"$2").replace(/\?/g,""),required:!o.includes("?"),desc:c.filter(Boolean),types:u},d=t.findIndex(A=>A.name===l.name);d>=0&&t.splice(d,1),t.push(l),c=[]}else/^\s*\/\/(.+)/.test(f)&&(c||(c=[]),c.push(RegExp.$1.trim()))}),t}const j=":--",ie={left:j,center:":--:",right:"--:"};function J(e){if(!N(e)||!m(e.tbody))return[];let{align:s}=e;const{thead:t,tbody:r}=e,n=[];let c=0;for(m(t)?(n.push(t.join("|")),s?(typeof s=="string"&&(s=t.reduce((f,o)=>(f[o]=s,f),{})),n.push(t.map(f=>ie[s[f]]||j).join("|"))):n.push(t.map(()=>j).join("|"))):(n.push(r[0].join("|"),r[0].map(()=>j).join("|")),c=1);c<r.length;c++)n.push(r[c].join("|"));return n}function de(e,s,t={}){const r=Object.keys(g);m(t.expendTypes)&&t.expendTypes.forEach(h=>{h&&!r.includes(h)&&r.push(h)});const n=new RegExp(`^\\*\\s*@(${r.join("|")})\\s*(.+)`),c=[g.type,g.constant];m(t.codeTypes)&&t.codeTypes.forEach(h=>{c.push(h)});let f=!1,o=!1,u=null,l=null,d,A;return b.default.readFileSync(e,"utf8").toString().split(new RegExp(V.default.EOL)).forEach(h=>{var y;const x=h;if(h=h.trim(),n.test(h)){f=!0,u=RegExp.$1;const T=RegExp.$2.trim();l=I(T),d=`${u}_${l}`,s[d]={type:u,sort:0,name:l,fullName:T,desc:[],params:[],returns:[],codes:[],private:!1,path:e};return}else if(h==="*/"&&f){f=!1;return}if(h==="/**"&&(l=null),!f||!l){l&&c.includes(u)&&h&&s[d].codes.push(x.replace(/^export(\s+default)?\s*/,""));return}if(typeof((y=t.expendTypesHandlers)==null?void 0:y[u])=="function")t.expendTypesHandlers[u](s[d],h);else{if(/^\*\s*(```\w+|@code)/.test(h)&&(o=!0),/^\*(.*)/.test(h)){A=RegExp.$1;const T=A.trim();if(T.startsWith("@param"))s[d].params.push(G(T));else if(T.startsWith("@return"))s[d].returns.push(Y(T));else if(T.startsWith("@private"))s[d].private=!0;else if(T.startsWith("@sort"))s[d].sort=z(T);else if(o){T.startsWith("@code")&&(t.isExtractCodeFromComments&&s[d].codes.push(""),A=A.replace(/@code\w*/,"").trim());const L=A.replace(/^\s/,"").replace("*\\/","*/");t.isExtractCodeFromComments?s[d].codes.push(L):s[d].desc.push(L)}else s[d].desc.push(T.replace("@description","").trim())}o&&/^\*\s*```$/.test(h)&&(o=!1)}}),s}function Q(e,s,t={}){const r={};return N(s)&&(t=s,s=!1),F(e,r,t),he(r,t),s?D(r,t):r}function F(e,s,t){const{fileType:r=/\.(ts|js)$/}=t;if(Array.isArray(e))e.forEach(n=>{F(n,s,t)});else{const n=b.default.statSync(e);n.isDirectory()?b.default.readdirSync(e).forEach(c=>{F(W.default.join(e,c),s,t)}):n.isFile()&&r.test(e)&&(s[e]={},de(e,s[e],t))}}function X(e){if(Array.isArray(e))return e.filter(r=>r.type===g.type);const s=[];let t;return Object.keys(e).forEach(r=>{Object.keys(e[r]).forEach(n=>{t=e[r][n],t.type===g.type&&s.push(t)})}),s}function he(e,s){const t=X(e);m(s.types)&&t.push(...s.types),t.forEach(r=>{r.props=B(r,t)})}function ye(e,s,t={}){e.returns.length||e.returns.push({raw:"`void`",types:["void"],desc:[]}),s.push(`### ${e.fullName}`,i,...e.desc,i,...t.methodWithRaw?e.params.map(r=>`- @param ${r.raw}`):v(e.params,g.method,"Param",t),i,...e.returns.map(r=>`- @returns ${r.raw}`),i),Z(e.codes,s,t)}function Z(e,s,t={}){t.isExtractCodeFromComments&&s.push(...e,i)}function pe(e,s,t={}){var d;s.push(`### ${e.fullName}`,i,...e.desc,i);const r=v(e.props,g.type,"Prop",t),n=["```ts",...e.codes,"```",i],c=(d=t.alias)==null?void 0:d.sourceCodeSummary,f=["<details>",`<summary>${c||"Source Code"}</summary>`,i,...n,i,"</details>",i],{typeWithSourceCode:o,typeWithTable:u,typeWithAuto:l}=t;o&&u?s.push(...r,...n):o?s.push(...n):u?s.push(...r):r.length?s.push(...r,...f):l?s.push(...n):s.push(...f)}function me(e){let s=0;const t=[];return e.forEach(r=>{r===i?s++:s=0,!(s>1)&&t.push(r)}),t}function ge(e,s,t){var f,o,u;if(!m(e))return;const r=((f=s.alias)==null?void 0:f.types)||{},n=S((u=(o=s.lines)==null?void 0:o.afterTitle)==null?void 0:u[g.document]);let c=null;return e.forEach((l,d)=>{d===0?(c=l.name+".md",t.push(`# ${r[g.document]||l.fullName}`,i),m(n)&&t.push(...n,i)):t.push(`### ${l.fullName}`,i),t.push(...l.desc,i),Z(l.codes,t,s)}),c}function Te(e,s,t){!m(e)||(O(g.method,s,t),e.forEach(r=>{ye(r,t,s)}))}function Ee(e,s,t){!m(e)||(O(g.type,s,t),e.forEach(r=>{pe(r,t,s)}))}function O(e,s,t){var f,o,u;const r=((f=s.alias)==null?void 0:f.types)||{},n={document:"Document",method:"Methods",type:"Types",constant:"Constants"};t.push(`## ${r[e]||n[e]||e}`,i);const c=S((u=(o=s.lines)==null?void 0:o.afterTitle)==null?void 0:u[e]);m(c)&&t.push(...c,i)}function Ae(e,s,t){!m(e)||(O(g.constant,s,t),e.forEach(r=>{t.push(`### ${r.fullName}`,i,...r.desc,i),m(r.codes)&&t.push("```ts",...r.codes,"```",i)}))}function ee(e,s,t={}){var A,h,x;console.log("Output file is start ...");const r={};let n=null;e.forEach(y=>{r[y.type]||(r[y.type]=[]),r[y.type].push(y)});const c=[],f=S((A=t.lines)==null?void 0:A.start);m(f)&&c.push(...f,i);const o=((h=t.lines)==null?void 0:h.afterType)||{};(m(t.outputDocTypesAndOrder)?t.outputDocTypesAndOrder:["document","method","type","constant"]).forEach(y=>{var L;const T=(L=t.handlers)==null?void 0:L[y];typeof T=="function"?T(r[y],t,c):y===g.document?n=ge(r[y],t,c):y===g.method?Te(r[y],t,c):y===g.type?Ee(r[y],t,c):y===g.constant&&Ae(r[y],t,c),o[y]&&c.push(...S(o[y]),i)});const l=S((x=t.lines)==null?void 0:x.end);m(l)&&c.push(...l,i);const d=me(c);return s&&(k(s)?n=s:n&&(n=W.default.join(s,n)),n&&se(n,d)),H(n),console.log("Output file is ended."),{outputFileName:n,lines:d,data:e}}function se(e,s){Array.isArray(s)&&(s=s.join(V.default.EOL)),b.default.writeFileSync(e,s,"utf8")}function be(e,s,t={}){N(s)&&(t=s,s=void 0),(typeof e=="string"||m(e)&&e.every(c=>typeof c=="string"))&&(e=Q(e,!0,t));const r=t.lines||{start:t.startLines,end:t.endLines,afterType:t.linesAfterType,afterTitle:t.linesAfterTitle},n=t.alias||{tableHead:t.tableHeadAlias};if(t=ce(ne({},t),{lines:r,alias:n}),s&&!b.default.existsSync(s))if(k(s)){const c=s.split("/");c.pop(),w(c.join("/"))}else w(s);return Array.isArray(e)?ee(e,s,t):ee(D(e,t),s,t)}a.BLANK_LINE=i,a.DOC_TYPES=g,a.createPropsTable=v,a.error=ue,a.findCharIndex=K,a.formatAsArray=S,a.formatAsTypes=C,a.getCommentsData=Q,a.getTypeName=I,a.getTypes=X,a.handleParam=G,a.handleProps=B,a.handleReturn=Y,a.handleSort=z,a.isFileLike=k,a.isValidArray=m,a.log=H,a.mergeIntoArray=D,a.mkdirSync=w,a.outputFile=be,a.replaceVerticalBarsInTables=q,a.toArray=U,a.toStrForStrArray=M,a.toTableLines=J,a.warn=_,a.writeFileSync=se,Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
