/*!
 * zx-sml version 0.7.0
 * Author: Xing Zhong<zx198401@gmail.com>
 * Repository: https://github.com/capricorncd/zx-sml
 * Released on: 2023-05-13 11:15:49 (GMT+0900)
 */
(function(a,p){typeof exports=="object"&&typeof module!="undefined"?p(exports,require("node:fs"),require("node:os"),require("node:path")):typeof define=="function"&&define.amd?define(["exports","node:fs","node:os","node:path"],p):(a=typeof globalThis!="undefined"?globalThis:a||self,p(a.zxDocgen={},a.fs,a.os,a.path))})(this,function(a,p,A,fe){"use strict";var Se=Object.defineProperty,Le=Object.defineProperties;var we=Object.getOwnPropertyDescriptors;var re=Object.getOwnPropertySymbols;var Ce=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable;var ne=(a,p,A)=>p in a?Se(a,p,{enumerable:!0,configurable:!0,writable:!0,value:A}):a[p]=A,ce=(a,p)=>{for(var A in p||(p={}))Ce.call(p,A)&&ne(a,A,p[A]);if(re)for(var A of re(p))je.call(p,A)&&ne(a,A,p[A]);return a},ae=(a,p)=>Le(a,we(p));function N(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var b=N(p),W=N(A),P=N(fe);const u="",g={method:"method",type:"type",document:"document",constant:"constant"};function oe(e){return Array.isArray(e)}function _(e){return typeof e=="object"&&e!==null&&!oe(e)}function le(e){return e.replace(/^-?[1-9]\d{0,2}(,\d{3})+/,t=>t.replace(/,/g,""))}function H(e,t=!1){if(typeof e=="number")return e;if(typeof e=="string"){if(!t&&/^(-?\d+(?:\.\d+)?)\D*/.test(le(e)))return H(RegExp.$1,!0);const s=Number(e);return isNaN(s)?0:s}return 0}const $={red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",white:"\x1B[37m"};function M(...e){console.log("\u{1F60E}",$.green,...e,$.white)}function q(...e){console.log("\u{1F615}",$.yellow,...e,$.white)}function ue(...e){console.log("\u{1F621}",$.red,...e,$.white)}const C="left",j=":--",ie={left:j,center:":--:",right:"--:"};function L(e){if(!e||b.default.existsSync(e)){q(`The directory already exists, or is null, ${e}`);return}const t=e.lastIndexOf("/");if(t===-1){q(`The 'dir' maybe a valid directory name, ${e}`);return}const s=e.substring(0,t);b.default.existsSync(s)?b.default.mkdirSync(e):(L(s),L(e))}function k(e){return typeof e=="string"?/.+\.\w+$/.test(e):!1}function m(e){return Array.isArray(e)&&e.length>0}function K(e,t=" ",s="-"){const r=e.filter(n=>!!n);return r.length?r.join(t):s}function G(e,t,s){let r=-1;for(let n=0;n<s&&(r=e.indexOf(t,r+1),r!==-1);n++);return r}function S(e){return typeof e=="undefined"?[]:Array.isArray(e)?e:[e]}function R(e){return e=e.trim(),e.endsWith(";")&&(e=e.substr(0,e.length-1)),!e.includes("|")||/^(\w+<([^<]|\([^(]+\)\[\]|\w+<[^<]+>)+>|\([^(]+\)\[\])$/.test(e)?[e]:e.split(/\s*\|\s*/)}function D(e){return e.replace(/\|/g,"\\|")}function de(e){const t=G(e,"`",2);return t===-1?"":e.substr(t+1)}function Y(e){e=e.replace("@param","").trim();const t={raw:e};if(/(\w+\??)\s+`([^`]+)`(.*)/.test(e)){const s=RegExp.$1;t.name=s.replace("?",""),t.required=!s.includes("?"),t.types=R(RegExp.$2);const r=RegExp.$3||de(e);t.desc=[r.trim()]}return t}function z(e){e=e.replace(/@returns?/,"").trim();const t={raw:e};return/`([^`]+)`\s*(.*)/.test(e)&&(t.types=R(RegExp.$1),t.desc=[RegExp.$2]),t}function U(e){return/@sort\s*(-?\d+)/.test(e)?H(RegExp.$1):0}function I(e){return e.replace(/^([\w.]+).*/,"$1")}function v(e,t,s="Name",r={}){if(!m(e))return[];const n=r.alias||{},c=n.tableHead||{};let f={0:"no",1:"yes"};n.requiredValues&&(n.requiredValues[t]?f=n.requiredValues[t]:n.requiredValues[0]&&n.requiredValues[1]&&(f=n.requiredValues));const o=r.tableAlign||{},i={align:{[s]:o[s]||C,Types:o.Types||C,Required:o.Required||C,Description:o.Description||C},thead:[c[s]||s,c.Types||"Types",c.Required||"Required",c.Description||"Description"],tbody:e.map(l=>{var E;return[l.name,"`"+D((E=l.types)==null?void 0:E.join("`/`"))+"`",f[+l.required],D(K(l.desc))]})},d=Q(i);return d.push(u),d}function B(e,t){const s=Object.keys(e).reduce((r,n)=>(Object.keys(e[n]).forEach(c=>{r[c]=e[n][c]}),r),{});return J(s,t)}function J(e,t={}){const s=[],r=Object.keys(e);return t.disableKeySorting||r.sort(),r.forEach(n=>s.push(e[n])),s.some(n=>n.sort)&&s.sort((n,c)=>n.sort-c.sort),s}function F(e,t){if(e.props)return e.props;const s=[],r=e.codes[0]||"";/\sextends\s+(.+)\s*\{/.test(r)&&RegExp.$1.split(/\s*,\s*/).map(o=>I(o.trim())).forEach(o=>{const i=t.find(d=>d.name===o);i&&(i.props||(i.props=F(i,t)),s.push(...i.props))});let n=!1,c=[];return e.codes.forEach(f=>{if(!n&&/\{\s*$/.test(f))return n=!0;if(/^\s*(?:(?:readonly|static|public)\s+)?((?:(?:\w|\[.+\])+|(?:'.+')|(?:".+"))\??)\s*:\s*([^/]*)(?:\/\/(.*))?/.test(f)){const o=RegExp.$1,i=R(RegExp.$2);c.push(RegExp.$3.trim());const d={name:o.replace(/('|")(.+)\1/,"$2").replace(/\?/g,""),required:!o.includes("?"),desc:c.filter(Boolean),types:i},l=s.findIndex(E=>E.name===d.name);l>=0&&s.splice(l,1),s.push(d),c=[]}else/^\s*\/\/(.+)/.test(f)&&(c||(c=[]),c.push(RegExp.$1.trim()))}),s}function Q(e){if(!_(e)||!m(e.tbody))return[];let{align:t}=e;const{thead:s,tbody:r}=e,n=[];let c=0;for(m(s)?(n.push(s.join("|")),t?(typeof t=="string"&&(t=s.reduce((f,o)=>(f[o]=t,f),{})),n.push(s.map(f=>ie[t[f]]||j).join("|"))):n.push(s.map(()=>j).join("|"))):(n.push(r[0].join("|"),r[0].map(()=>j).join("|")),c=1);c<r.length;c++)n.push(r[c].join("|"));return n}function he(e,t,s={}){const r=Object.keys(g);m(s.expendTypes)&&s.expendTypes.forEach(h=>{h&&!r.includes(h)&&r.push(h)});const n=new RegExp(`^\\*\\s*@(${r.join("|")})\\s*(.+)`),c=[g.type,g.constant];m(s.codeTypes)&&s.codeTypes.forEach(h=>{c.push(h)});let f=!1,o=!1,i=null,d=null,l,E;return b.default.readFileSync(e,"utf8").toString().split(new RegExp(W.default.EOL)).forEach(h=>{var y;const x=h;if(h=h.trim(),n.test(h)){f=!0,i=RegExp.$1;const T=RegExp.$2.trim();d=I(T),l=`${i}_${d}`,t[l]={type:i,sort:0,name:d,fullName:T,desc:[],params:[],returns:[],codes:[],private:!1,path:e};return}else if(h==="*/"&&f){f=!1;return}if(h==="/**"&&(d=null),!f||!d){d&&c.includes(i)&&h&&t[l].codes.push(x.replace(/^export(\s+default)?\s*/,""));return}if(typeof((y=s.expendTypesHandlers)==null?void 0:y[i])=="function")s.expendTypesHandlers[i](t[l],h);else{if(/^\*\s*(```\w+|@code)/.test(h)&&(o=!0),/^\*(.*)/.test(h)){E=RegExp.$1;const T=E.trim();if(T.startsWith("@param"))t[l].params.push(Y(T));else if(T.startsWith("@return"))t[l].returns.push(z(T));else if(T.startsWith("@private"))t[l].private=!0;else if(T.startsWith("@sort"))t[l].sort=U(T);else if(o){T.startsWith("@code")&&(s.isExtractCodeFromComments&&t[l].codes.push(""),E=E.replace(/@code\w*/,"").trim());const w=E.replace(/^\s/,"").replace("*\\/","*/");s.isExtractCodeFromComments?t[l].codes.push(w):t[l].desc.push(w)}else t[l].desc.push(T.replace("@description","").trim())}o&&/^\*\s*```$/.test(h)&&(o=!1)}}),t}function X(e,t,s={}){const r={};return _(t)&&(s=t,t=!1),O(e,r,s),ye(r,s),t?B(r,s):r}function O(e,t,s){const{fileType:r=/\.(ts|js)$/}=s;if(Array.isArray(e))e.forEach(n=>{O(n,t,s)});else{const n=b.default.statSync(e);n.isDirectory()?b.default.readdirSync(e).forEach(c=>{O(P.default.join(e,c),t,s)}):n.isFile()&&r.test(e)&&(t[e]={},he(e,t[e],s))}}function Z(e){if(Array.isArray(e))return e.filter(r=>r.type===g.type);const t=[];let s;return Object.keys(e).forEach(r=>{Object.keys(e[r]).forEach(n=>{s=e[r][n],s.type===g.type&&t.push(s)})}),t}function ye(e,t){const s=Z(e);m(t.types)&&s.push(...t.types),s.forEach(r=>{r.props=F(r,s)})}function pe(e,t,s={}){e.returns.length||e.returns.push({raw:"`void`",types:["void"],desc:[]}),t.push(`### ${e.fullName}`,u,...e.desc,u,...s.methodWithRaw?e.params.map(r=>`- @param ${r.raw}`):v(e.params,g.method,"Param",s),u,...e.returns.map(r=>`- @returns ${r.raw}`),u),ee(e.codes,t,s)}function ee(e,t,s={}){s.isExtractCodeFromComments&&t.push(...e,u)}function me(e,t,s={}){var l;t.push(`### ${e.fullName}`,u,...e.desc,u);const r=v(e.props,g.type,"Prop",s),n=["```ts",...e.codes,"```",u],c=(l=s.alias)==null?void 0:l.sourceCodeSummary,f=["<details>",`<summary>${c||"Source Code"}</summary>`,u,...n,u,"</details>",u],{typeWithSourceCode:o,typeWithTable:i,typeWithAuto:d}=s;o&&i?t.push(...r,...n):o?t.push(...n):i?t.push(...r):r.length?t.push(...r,...f):d?t.push(...n):t.push(...f)}function ge(e){let t=0;const s=[];return e.forEach(r=>{r===u?t++:t=0,!(t>1)&&s.push(r)}),s}function Te(e,t,s){var f,o,i;if(!m(e))return;const r=((f=t.alias)==null?void 0:f.types)||{},n=S((i=(o=t.lines)==null?void 0:o.afterTitle)==null?void 0:i[g.document]);let c=null;return e.forEach((d,l)=>{l===0?(c=d.name+".md",s.push(`# ${r[g.document]||d.fullName}`,u),m(n)&&s.push(...n,u)):s.push(`### ${d.fullName}`,u),s.push(...d.desc,u),ee(d.codes,s,t)}),c}function Ee(e,t,s){!m(e)||(V(g.method,t,s),e.forEach(r=>{pe(r,s,t)}))}function Ae(e,t,s){!m(e)||(V(g.type,t,s),e.forEach(r=>{me(r,s,t)}))}function V(e,t,s){var f,o,i;const r=((f=t.alias)==null?void 0:f.types)||{},n={document:"Document",method:"Methods",type:"Types",constant:"Constants"};s.push(`## ${r[e]||n[e]||e}`,u);const c=S((i=(o=t.lines)==null?void 0:o.afterTitle)==null?void 0:i[e]);m(c)&&s.push(...c,u)}function be(e,t,s){!m(e)||(V(g.constant,t,s),e.forEach(r=>{s.push(`### ${r.fullName}`,u,...r.desc,u),m(r.codes)&&s.push("```ts",...r.codes,"```",u)}))}function se(e,t,s={}){var E,h,x;console.log("Output file is start ...");const r={};let n=null;e.forEach(y=>{r[y.type]||(r[y.type]=[]),r[y.type].push(y)});const c=[],f=S((E=s.lines)==null?void 0:E.start);m(f)&&c.push(...f,u);const o=((h=s.lines)==null?void 0:h.afterType)||{};(m(s.outputDocTypesAndOrder)?s.outputDocTypesAndOrder:["document","method","type","constant"]).forEach(y=>{var w;const T=(w=s.handlers)==null?void 0:w[y];typeof T=="function"?T(r[y],s,c):y===g.document?n=Te(r[y],s,c):y===g.method?Ee(r[y],s,c):y===g.type?Ae(r[y],s,c):y===g.constant&&be(r[y],s,c),o[y]&&c.push(...S(o[y]),u)});const d=S((x=s.lines)==null?void 0:x.end);m(d)&&c.push(...d,u);const l=ge(c);return t&&(k(t)?n=t:n&&(n=P.default.join(t,n)),n&&te(n,l)),M(n),console.log("Output file is ended."),{outputFileName:n,lines:l,data:e}}function te(e,t){Array.isArray(t)&&(t=t.join(W.default.EOL)),b.default.writeFileSync(e,t,"utf8")}function $e(e,t,s){_(t)&&(s=t,t=void 0),s=s||{},(typeof e=="string"||m(e)&&e.every(c=>typeof c=="string"))&&(e=X(e,!0,s));const r=s.lines||{start:s.startLines,end:s.endLines,afterType:s.linesAfterType,afterTitle:s.linesAfterTitle},n=s.alias||{tableHead:s.tableHeadAlias};if(s=ae(ce({},s),{lines:r,alias:n}),t&&!b.default.existsSync(t))if(k(t)){const c=t.split("/");c.pop(),L(c.join("/"))}else L(t);return Array.isArray(e)?se(e,t,s):se(B(e,s),t,s)}a.BLANK_LINE=u,a.DOC_TYPES=g,a.createPropsTable=v,a.error=ue,a.findCharIndex=G,a.formatAsArray=S,a.formatAsTypes=R,a.getCommentsData=X,a.getTypeName=I,a.getTypes=Z,a.handleParam=Y,a.handleProps=F,a.handleReturn=z,a.handleSort=U,a.isFileLike=k,a.isValidArray=m,a.log=M,a.mergeIntoArray=B,a.mkdirSync=L,a.outputFile=$e,a.replaceVerticalBarsInTables=D,a.toArray=J,a.toStrForStrArray=K,a.toTableLines=Q,a.warn=q,a.writeFileSync=te,Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
