/*!
 * zx-sml version 0.7.0
 * Author: Xing Zhong<zx198401@gmail.com>
 * Repository: https://github.com/capricorncd/zx-sml
 * Released on: 2023-05-11 21:58:45 (GMT+0900)
 */
(function(c,p){typeof exports=="object"&&typeof module!="undefined"?p(exports,require("node:fs"),require("node:os"),require("node:path")):typeof define=="function"&&define.amd?define(["exports","node:fs","node:os","node:path"],p):(c=typeof globalThis!="undefined"?globalThis:c||self,p(c.zxDocgen={},c.fs,c.os,c.path))})(this,function(c,p,A,ae){"use strict";var be=Object.defineProperty,$e=Object.defineProperties;var Se=Object.getOwnPropertyDescriptors;var se=Object.getOwnPropertySymbols;var we=Object.prototype.hasOwnProperty,Le=Object.prototype.propertyIsEnumerable;var te=(c,p,A)=>p in c?be(c,p,{enumerable:!0,configurable:!0,writable:!0,value:A}):c[p]=A,re=(c,p)=>{for(var A in p||(p={}))we.call(p,A)&&te(c,A,p[A]);if(se)for(var A of se(p))Le.call(p,A)&&te(c,A,p[A]);return c},ne=(c,p)=>$e(c,Se(p));function x(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var b=x(p),V=x(A),W=x(ae);const o="",g={method:"method",type:"type",document:"document",constant:"constant"};function ce(e){return Array.isArray(e)}function N(e){return typeof e=="object"&&e!==null&&!ce(e)}function fe(e){return e.replace(/^-?[1-9]\d{0,2}(,\d{3})+/,s=>s.replace(/,/g,""))}function F(e,s=!1){if(typeof e=="number")return e;if(typeof e=="string"){if(!s&&/^(-?\d+(?:\.\d+)?)\D*/.test(fe(e)))return F(RegExp.$1,!0);const t=Number(e);return isNaN(t)?0:t}return 0}const $={red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",white:"\x1B[37m"};function P(...e){console.log("\u{1F60E}",$.green,...e,$.white)}function C(...e){console.log("\u{1F615}",$.yellow,...e,$.white)}function oe(...e){console.log("\u{1F621}",$.red,...e,$.white)}function w(e){if(!e||b.default.existsSync(e)){C(`The directory already exists, or is null, ${e}`);return}const s=e.lastIndexOf("/");if(s===-1){C(`The 'dir' maybe a valid directory name, ${e}`);return}const t=e.substring(0,s);b.default.existsSync(t)?b.default.mkdirSync(e):(w(t),w(e))}function _(e){return typeof e=="string"?/.+\.\w+$/.test(e):!1}function m(e){return Array.isArray(e)&&e.length>0}function H(e,s=" ",t="-"){const r=e.filter(n=>!!n);return r.length?r.join(s):t}function M(e,s,t){let r=-1;for(let n=0;n<t&&(r=e.indexOf(s,r+1),r!==-1);n++);return r}function S(e){return typeof e=="undefined"?[]:Array.isArray(e)?e:[e]}function L(e){return e=e.trim(),e.endsWith(";")&&(e=e.substr(0,e.length-1)),!e.includes("|")||/^(\w+<([^<]|\([^(]+\)\[\]|\w+<[^<]+>)+>|\([^(]+\)\[\])$/.test(e)?[e]:e.split(/\s*\|\s*/)}function k(e){return e.replace(/\|/g,"\\|")}function le(e){const s=M(e,"`",2);return s===-1?"":e.substr(s+1)}function K(e){e=e.replace("@param","").trim();const s={raw:e};if(/(\w+\??)\s+`([^`]+)`(.*)/.test(e)){const t=RegExp.$1;s.name=t.replace("?",""),s.required=!t.includes("?"),s.types=L(RegExp.$2);const r=RegExp.$3||le(e);s.desc=[r.trim()]}return s}function G(e){e=e.replace(/@returns?/,"").trim();const s={raw:e};return/`([^`]+)`\s*(.*)/.test(e)&&(s.types=L(RegExp.$1),s.desc=[RegExp.$2]),s}function Y(e){return/@sort\s*(-?\d+)/.test(e)?F(RegExp.$1):0}function q(e){return e.replace(/^([\w.]+).*/,"$1")}function v(e,s,t="Name",r={}){if(!m(e))return[];const n=r.alias||{},a=n.tableHead||{};let f={0:"no",1:"yes"};n.requiredValues&&(n.requiredValues[s]?f=n.requiredValues[s]:n.requiredValues[0]&&n.requiredValues[1]&&(f=n.requiredValues));const l={thead:[a[t]||t,a.Types||"Types",a.Required||"Required",a.Description||"Description"],tbody:e.map(i=>{var d;return[i.name,"`"+k((d=i.types)==null?void 0:d.join("`/`"))+"`",f[+i.required],k(H(i.desc))]})},u=U(l);return u.push(o),u}function D(e,s){const t=Object.keys(e).reduce((r,n)=>(Object.keys(e[n]).forEach(a=>{r[a]=e[n][a]}),r),{});return z(t,s)}function z(e,s={}){const t=[],r=Object.keys(e);return s.disableKeySorting||r.sort(),r.forEach(n=>t.push(e[n])),t.some(n=>n.sort)&&t.sort((n,a)=>n.sort-a.sort),t}function I(e,s){if(e.props)return e.props;const t=[],r=e.codes[0]||"";/\sextends\s+(.+)\s*\{/.test(r)&&RegExp.$1.split(/\s*,\s*/).map(l=>q(l.trim())).forEach(l=>{const u=s.find(i=>i.name===l);u&&(u.props||(u.props=I(u,s)),t.push(...u.props))});let n=!1,a=[];return e.codes.forEach(f=>{if(!n&&/\{\s*$/.test(f))return n=!0;if(/^\s*(?:(?:readonly|static|public)\s+)?((?:(?:\w|\[.+\])+|(?:'.+')|(?:".+"))\??)\s*:\s*([^/]*)(?:\/\/(.*))?/.test(f)){const l=RegExp.$1,u=L(RegExp.$2);a.push(RegExp.$3.trim());const i={name:l.replace(/('|")(.+)\1\??/,"$2"),required:!l.includes("?"),desc:a,types:u},d=t.findIndex(E=>E.name===i.name);d>=0&&t.splice(d,1),t.push(i),a=[]}else/^\s*\/\/(.+)/.test(f)&&(a||(a=[]),a.push(RegExp.$1.trim()))}),t}const j=":--",ue={left:j,center:":--:",right:"--:"};function U(e){if(!N(e)||!m(e.tbody))return[];let{align:s,thead:t,tbody:r}=e;const n=[];let a=0;for(m(t)?(n.push(t.join("|")),s?(typeof s=="string"&&(s=t.reduce((f,l)=>(f[l]=s,f),{})),n.push(t.map(f=>ue[s[f]]||j).join("|"))):n.push(t.map(()=>j).join("|"))):(n.push(r[0].join("|"),r[0].map(()=>j).join("|")),a=1);a<r.length;a++)n.push(r[a].join("|"));return n}function ie(e,s,t={}){const r=Object.keys(g);m(t.expendTypes)&&t.expendTypes.forEach(y=>{y&&!r.includes(y)&&r.push(y)});const n=new RegExp(`^\\*\\s*@(${r.join("|")})\\s*(.+)`),a=[g.type,g.constant];m(t.codeTypes)&&t.codeTypes.forEach(y=>{a.push(y)});let f=!1,l=!1,u=null,i=null,d,E;return b.default.readFileSync(e,"utf8").toString().split(new RegExp(V.default.EOL)).forEach(y=>{var h;const R=y;if(y=y.trim(),n.test(y)){f=!0,u=RegExp.$1;const T=RegExp.$2.trim();i=q(T),d=`${u}_${i}`,s[d]={type:u,sort:0,name:i,fullName:T,desc:[],params:[],returns:[],codes:[],private:!1,path:e};return}else if(y==="*/"&&f){f=!1;return}if(y==="/**"&&(i=null),!f||!i){i&&a.includes(u)&&y&&s[d].codes.push(R.replace(/^export(\s+default)?\s*/,""));return}if(typeof((h=t.expendTypesHandlers)==null?void 0:h[u])=="function")t.expendTypesHandlers[u](s[d],y);else{if(/^\*\s*(```\w+|@code)/.test(y)&&(l=!0),/^\*(.*)/.test(y)){E=RegExp.$1;const T=E.trim();T.startsWith("@param")?s[d].params.push(K(T)):T.startsWith("@return")?s[d].returns.push(G(T)):T.startsWith("@private")?s[d].private=!0:T.startsWith("@sort")?s[d].sort=Y(T):l?(T.startsWith("@code")&&(s[d].codes.push(""),E=E.replace(/@code\w*/,"").trim()),s[d].codes.push(E.replace(/^\s/,"").replace("*\\/","*/"))):s[d].desc.push(T.replace("@description","").trim())}l&&/^\*\s*```$/.test(y)&&(l=!1)}}),s}function J(e,s,t={}){const r={};return N(s)&&(t=s,s=!1),O(e,r,t),de(r,t),s?D(r,t):r}function O(e,s,t){const{fileType:r=/\.(ts|js)$/}=t;if(Array.isArray(e))e.forEach(n=>{O(n,s,t)});else{const n=b.default.statSync(e);n.isDirectory()?b.default.readdirSync(e).forEach(a=>{O(W.default.join(e,a),s,t)}):n.isFile()&&r.test(e)&&(s[e]={},ie(e,s[e],t))}}function Q(e){if(Array.isArray(e))return e.filter(r=>r.type===g.type);const s=[];let t;return Object.keys(e).forEach(r=>{Object.keys(e[r]).forEach(n=>{t=e[r][n],t.type===g.type&&s.push(t)})}),s}function de(e,s){const t=Q(e);m(s.types)&&t.push(...s.types),t.forEach(r=>{r.props=I(r,t)})}function ye(e,s,t={}){e.returns.length||e.returns.push({raw:"`void`",types:["void"],desc:[]}),s.push(`### ${e.fullName}`,o,...e.desc,o,...t.methodWithRaw?e.params.map(r=>`- @param ${r.raw}`):v(e.params,g.method,"Param",t),o,...e.returns.map(r=>`- @returns ${r.raw}`),o,...e.codes,o)}function he(e,s,t={}){var d;s.push(`### ${e.fullName}`,o,...e.desc,o);const r=v(e.props,g.type,"Prop",t),n=["```ts",...e.codes,"```",o],a=(d=t.alias)==null?void 0:d.sourceCodeSummary,f=["<details>",`<summary>${a||"Source Code"}</summary>`,o,...n,o,"</details>",o],{typeWithSourceCode:l,typeWithTable:u,typeWithAuto:i}=t;l&&u?s.push(...r,...n):l?s.push(...n):u?s.push(...r):r.length?s.push(...r,...f):i?s.push(...n):s.push(...f)}function pe(e){let s=0;const t=[];return e.forEach(r=>{r===o?s++:s=0,!(s>1)&&t.push(r)}),t}function me(e,s,t){var f,l,u;if(!m(e))return;const r=((f=s.alias)==null?void 0:f.types)||{},n=S((u=(l=s.lines)==null?void 0:l.afterTitle)==null?void 0:u[g.document]);let a=null;return e.forEach((i,d)=>{d===0?(a=i.name+".md",t.push(`# ${r[g.document]||i.fullName}`,o),m(n)&&t.push(...n,o)):t.push(`### ${i.fullName}`,o),t.push(...i.desc,o,...i.codes,o)}),a}function ge(e,s,t){!m(e)||(B(g.method,s,t),e.forEach(r=>{ye(r,t,s)}))}function Te(e,s,t){!m(e)||(B(g.type,s,t),e.forEach(r=>{he(r,t,s)}))}function B(e,s,t){var f,l,u;const r=((f=s.alias)==null?void 0:f.types)||{},n={document:"Document",method:"Methods",type:"Types",constant:"Constants"};t.push(`## ${r[e]||n[e]||e}`,o);const a=S((u=(l=s.lines)==null?void 0:l.afterTitle)==null?void 0:u[e]);m(a)&&t.push(...a,o)}function Ae(e,s,t){!m(e)||(B(g.constant,s,t),e.forEach(r=>{t.push(`### ${r.fullName}`,o,...r.desc,o),m(r.codes)&&t.push("```ts",...r.codes,"```",o)}))}function X(e,s,t={}){var E,y,R;console.log("Output file is start ...");const r={};let n=null;e.forEach(h=>{r[h.type]||(r[h.type]=[]),r[h.type].push(h)});const a=[],f=S((E=t.lines)==null?void 0:E.start);m(f)&&a.push(...f,o);const l=((y=t.lines)==null?void 0:y.afterType)||{};(m(t.outputDocTypesAndOrder)?t.outputDocTypesAndOrder:["document","method","type","constant"]).forEach(h=>{var ee;const T=(ee=t.handlers)==null?void 0:ee[h];typeof T=="function"?T(r[h],t,a):h===g.document?n=me(r[h],t,a):h===g.method?ge(r[h],t,a):h===g.type?Te(r[h],t,a):h===g.constant&&Ae(r[h],t,a),l[h]&&a.push(...S(l[h]),o)});const i=S((R=t.lines)==null?void 0:R.end);m(i)&&a.push(...i,o);const d=pe(a);return s&&(_(s)?n=s:n&&(n=W.default.join(s,n)),n&&Z(n,d)),P(n),console.log("Output file is ended."),{outputFileName:n,lines:d,data:e}}function Z(e,s){Array.isArray(s)&&(s=s.join(V.default.EOL)),b.default.writeFileSync(e,s,"utf8")}function Ee(e,s,t={}){(typeof e=="string"||m(e)&&e.every(a=>typeof a=="string"))&&(e=J(e,!0,t)),N(s)&&(t=s,s=void 0);const r=t.lines||{start:t.startLines,end:t.endLines,afterType:t.linesAfterType,afterTitle:t.linesAfterTitle},n=t.alias||{tableHead:t.tableHeadAlias};if(t=ne(re({},t),{lines:r,alias:n}),s&&!b.default.existsSync(s))if(_(s)){const a=s.split("/");a.pop(),w(a.join("/"))}else w(s);return Array.isArray(e)?X(e,s,t):X(D(e,t),s,t)}c.BLANK_LINE=o,c.DOC_TYPES=g,c.createPropsTable=v,c.error=oe,c.findCharIndex=M,c.formatAsArray=S,c.formatAsTypes=L,c.getCommentsData=J,c.getTypeName=q,c.getTypes=Q,c.handleParam=K,c.handleProps=I,c.handleReturn=G,c.handleSort=Y,c.isFileLike=_,c.isValidArray=m,c.log=P,c.mergeIntoArray=D,c.mkdirSync=w,c.outputFile=Ee,c.replaceVerticalBarsInTables=k,c.toArray=z,c.toStrForStrArray=H,c.toTableLines=U,c.warn=C,c.writeFileSync=Z,Object.defineProperties(c,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
